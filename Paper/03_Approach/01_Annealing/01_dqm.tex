\section{Unit Commitment Problem as Discrete Quadratic Model}

The MINLP formulation of the UCP is converted to a Discrete Quadratic Model (DQM).
As mentioned in section (\ref{backg:annealing}), this model is the extension
of Binary Quadratic Models (BQM) or Quadratic Unconstrained Binary Optimization model (QUBO).

\subsubsection{Mapping Variables}

The model, as seen in section (\ref{backg:annealing}), takes in a vector rather than a 2-dimensional matrix.
That's why the indices of the variables $p_{i,t}$ have to be mapped, such that the result are just as many variables $p_{l}$.

\begin{align}
  k:
  \quad
  \mathbb{I} \times \mathbb{T} \to \mathbb{K}:
  \quad
  k(i, t) = i \cdot | \mathbb{T} | + t
\end{align}

In the model below, $p_{i,t}$ is used, but this is to show, that

\begin{subequations}
\begin{align}
  &
  \forall i \in \mathbb{I}, \forall t, t' \in \mathbb{T}, t < t'
  &
  \Rightarrow k(i, t) < k(i, t')
  \\
  \land \quad
  &
  \forall t \in \mathbb{T}, \forall i, j \in \mathbb{I}, i < j
  &
  \Rightarrow k(i, t) < k(j, t)
\end{align}
\end{subequations}

When implementing the DQM, the discrete variables $p_{i, t}$ are added in the order specified by $k(i, t)$.
This makes sure that the quadratic biases are added in the right orientation.

\subsubsection{Discretizising Variables}

The power levels have to be discretized, since the model, respectively the variables, are discrete.
To maximize the utilization of qbits on the QPU, every variable $p_{i, t}$ can have one of $2^{n_i}$ values.
$n_i$ is chosen so that the difference $\delta_i$ between the non-zero power levels represented by the values of $p_{i, t}$
is $5 < \delta_i \leq 10$.
The power levels of the discrete values are represented as $P_i$.
Their values are:

\begin{align}
  P_i =
  \quad \begin{pmatrix}
    0 \\
    P_{min, i} \\
    P_{min, i} + \delta_i \\
    P_{min, i} + 2 \cdot \delta_i \\
    \vdots \\
    P_{max, i}
  \end{pmatrix}
\end{align}

This automatically enforces the constraint (\ref{formula:minlp.power}) that ensures the power limits to stay inside the limits of every power plant.
This constraint thus is not found in the energy function (\ref{formula:dqm.start.obj}-\ref{formula:dqm.start.demand}).

\subsection{Formulating the DQM}

The formula we start with (\ref{formula:dqm.start.obj}-\ref{formula:dqm.start.demand})
includes the objective function and every constraint of the MINLP formulation (\ref{formula:minlp}).
Except for the constraint (\ref{formula:minlp.power}) that makes sure the output of every power plant is within its limits.
This is already enforced by the discretization of the power levels.

The formula is not in the standard form (\ref{formula:dqm.form}).
To achieve this form, the last summand has to be transformed and the linear parts and quadratic parts have to be combined into groups.

\begin{subequations}
\begin{align}
  E(p) =
  &  \quad \gamma_c \sum_{i, t} F_i p_{i, t}
  \label{formula:dqm.start.obj} \\
  + & \quad \gamma_s \sum_i \left(
      S_i^{(0)} p_{i, 0}
      + \sum_{t > 0} S_i \left( p_{i, t-1} \otimes p_{i, t} \right)
    \right)
  \label{formula:dqm.start.startup} \\
  + & \quad \gamma_d \sum_t \left( \left( \sum_i P_i p_{i, t} \right) - l_t \right)^2
  \label{formula:dqm.start.demand}
\end{align}
\end{subequations}

\subsubsection{Objective Function}

The first summand of the energy function represents the objective function (\ref{formula:minlp.obj}) without the startup and shutdown costs.
The objective function simply takes the sum of the costs of operating the power plants at the level they are operating at every time instance.
This can be modeled by a vector that holds the cost of operating a power plant at the power level of the corresponding value.
It is achieved by applying the cost function used in the objective function (\ref{formula:minlp.obj}) element wise to $P_i$:

\begin{align}
  F_i = \quad \begin{pmatrix}
    0 \\
    A_i + B_i \cdot P_{min_i} + C_i \cdot \left( P_{min, i} \right)^2 \\
    A_i + B_i \cdot \left( P_{min_i} + \delta_i \right) + C_i \cdot \left( P_{min, i} + \delta_i \right)^2 \\
    A_i + B_i \cdot \left( P_{min_i} + 2 \cdot \delta_i \right) + C_i \cdot \left( P_{min, i} + 2 \cdot \delta_i \right)^2 \\
    \vdots \\
    A_i + B_i \cdot \left( P_{max_i} \right) + C_i \cdot \left( P_{max, i} \right)^2 \\
  \end{pmatrix}
\end{align}

As stated before, the multiplication of the vectors $F_i$ and $p_{i, t}$ in the term (\ref{formula:dqm.start.obj}) represents the scalar product $\left\langle F_i, p_{i, t} \right\rangle$.
Which is the addition of all elements multiplied element-wise.
Since only one element of the vector $p_{i, t}$ is $1$, all other elements are $0$, the resulting value is one element of $F_i$.
Specifically, the result of the scalar product is the element of $F_i$ that corresponds to the $1$-element in $p_{i, t}$.
$F_i$ is called the linear bias of $p_{i, t}$.

\subsubsection{Startup and Shutdown Costs}

The second summand of the energy function represents the startup and shutdown costs (\ref{formula:minlp.updowncost}).
When a power plant $i$ starts, it costs the plant a specified amount of fuel $A_i^U$.
When it shuts down, it costs the plant the specified amount $A_i^D$.

The initial startup and shutdown costs can be modeled by a vector that holds either the startup costs or the shutdown costs.
So for the variables $p_{i, 0}$ the term (\ref{formula:dqm.start.startup}) produces an addition to the linear bias.
$S_i^{(0)}$ depends on the initial state $u_{i, -1}$ of the power plant $i$ and represents either the startup cost or the shutdown cost of the plant.
The startup costs are only non-zero in the elements that represent a power output that is greater than zero, so every element other than the zeroth.
While the shutdown cost is only relevant in the zeroth element because that element corresponds to a shutdown plant.

\begin{align}
  S_i^{(0)} = \quad \begin{cases}
    \begin{pmatrix}
      0 \\ A_i^U \\ \vdots \\ A_i^U
    \end{pmatrix}
    & , u_{i, -1} = 0 \\
    \begin{pmatrix}
      A_i^D \\ 0 \\ \vdots \\ 0
    \end{pmatrix}
    & , u_{i, -1} = 1
  \end{cases}
\end{align}

The startup and shutdown costs to later time instances can be modeled by a matrix that holds both the startup and shutdown costs of one plant.
For all other variables, so $p_{i, t}$ for $t > 0$, the term (\ref{formula:dqm.start.startup}) does not produce linear biases, but rather quadratic ones.
These are biases that depend on two variables.
Here they depend on $p_{i, t-1}$ and $p_{i, t}$.
There is one matrix for every power plant $i$.
This matrix holds the startup costs $A_i^U$ at the elements in the zeroth row and column greater than zero.
While the shutdown costs $A_i^D$ are at the elements in the zeroth column and row greater than zero.

\begin{align}
  S_i = \quad \begin{pmatrix}
    0   & A_U & \ldots & A_U \\
    A_D &   0 & \ldots &   0 \\
    \vdots & \vdots & \ddots & \vdots \\
    A_D &   0 & \ldots &   0
  \end{pmatrix}
\end{align}


As stated before, the multiplication of the matrices $S_i$ and $p_{i, t-1} \otimes p_{i, t}$ represents the Frobenius Inner Product $\left\langle S_i, p_{i, t-1} \otimes p_{i, t} \right\rangle_F$.
Which is similar to the scalar product of vectors.
It is the sum of the element-wise products of both matrices.
One element of each vector $p_{i, t-1}$ and $p_{i, t}$ has the value $1$, so only one element of their tensor product has the value $1$.
Since all other elements of the tensor product are zero, the result of the inner product is one element of $S_i$.
Specifically, the result of the inner product is the element of $S_i$ that corresponds to the $1$-element in the tensor product.
This element represents the change of the power level of the power plant $i$ at the time step from $t-1$ to $t$.
That is why the matrix $S_i$ holds the startup costs at the elements, that correspond to zero output in $t-1$ and non-zero output in $t$ and vice versa.
$S_i$ is called quadratic bias.

\subsubsection{Demand}

\todo{Resolve demand part}

\subsubsection{Result}

\begin{subequations}
\begin{align}
  E(p) = \quad
  &
  \gamma_c \sum_{i, t} F_i p_{i, t}
  + \gamma_s \sum_i \left(
      S_i^{(0)} p_{i, 0}
      + \sum_{t > 0} S_i \left( p_{i, t-1} \otimes p_{i, t} \right)
    \right)
  \\ &
  + \gamma_d \sum_t \left(
    L_t^2
    + \sum_i \left( P_i p_{i, t} \right)^2 - l_t \sum_i P_i p_{i, t}
    + \sum_{i < j} \left( P_i p_{i, t} \right) \left( P_i p_{j, t} \right)
  \right) \\
  = \quad
  &
  \gamma_s \sum_i \sum_{t > 0} S_i \left( p_{i, t-1} \otimes p_{i, t} \right)
  + \gamma_d \sum_t \sum_{i < j} \left( P_i \otimes P_j \right) \left( p_{i, t} \otimes p_{j, t} \right)
  \\ &
  + \sum_{i, t} \left(
    \gamma_c F_i + \gamma_d \left(P_i^2 - l_t P_i \right)
  \right) p_{i, t}
  + \sum_i S_i^{(0)} p_{i, 0}
  \\ &
  + \sum_t l_t^2
\end{align}
\end{subequations}
