\section{Unit Commitment Problem as Quadratic Unconstrained Binary Model}

The formulation of the Quadratic Unconstrained Binary Model (QUBO) is based on the DQM formulated in section \ref{approach:annealing.formulate}.
Instead of a single discrete variable for every power plant $i$ and time instance $t$, the QUBO has an array of binary variables for every possible power level in $P_i$ for every power plant $i$ and time $t$.

\subsection{Mapping Variables}
\label{approach:qubo.map}

The variable indices are mapped to a single index to make sure the QUBO form is correct.
In addition to the mapping in \ref{approach:dqm.map}, this mapping also considers the power levels of each power plant.
The mapping is extended by a third index $k$ corresponding to the power level.
\begin{align}
  m': \quad
  \I \times \T \times \{k \in \mathbb{N}_0 | k < |P_i|\}
  \to \mathbb{M}': \quad
  m'(i, t, k) = \left( |\mathbb{T}| \sum_{j=0}^{i-1} |P_j| \right)
  + t \cdot |P_i|
  + k
  \label{formula:qubo.mapping}
\end{align}

In the model below, $p_{i,t,k}$ is used, but this is to show that
\begin{align}
\begin{split}
  &
  \forall i \in \I, t \in \T, k, l \in \mathbb{N}_0, k < l < |P_i|:
  m'(i, t, k) < m'(i, t, l)
  \\
  \land \quad &
  \forall i \in \I, t, t' \in \T, k \in \mathbb{N}_0, k < |P_i|, t < t':
  m'(i, t, k) < m'(i, t', k)
  \\
  \land \quad &
  \forall i, j \in \I, t  \in \T, k, l \in \mathbb{N}_0, k < |P_i|, l < |P_j|, i < j:
  m'(i, t, k) < m'(j, t, l)
\end{split}
\end{align}

When implementing the QUBO, the discrete variables $p_{i, t, k}$ are added in the order specified by $m'(i, t, k)$.
This order ensures that the applying of quadratic biases does not violate the form of the QUBO.
When adding a quadratic bias, the first argument is always a variable with a lower index $m'(i, t, k)$.

\subsection{Discretizising Power Levels}
\label{approach:qubo.discretize}

This approach discretizes the power levels just like in section \ref{approach:dqm.discretize}.
But this time, the values are not an array but single values.
They are defined as
\begin{align}
  P_{i, k} = \begin{cases}
    0 & , k = 0 \\
    P_{min, i} + (k - 1) \cdot \delta_i & , else
  \end{cases}
\end{align}

$P_{i, k}$ is defined for all $i \in \I, k \in \mathbb{N}_0, k < 2^{n_i}$.
Where $n_i$ is chosen as in section \ref{approach:dqm.discretize}.
Thus $P_{i, 2^{n_i} - 1} = P_{max, i}$.

This automatically enforces the constraint (\ref{formula:minlp.power}) ensuring that the power outputs stay inside the limits of every power plant.
That constraint thus is not found in the energy function (\ref{formula:qubo.result}).

\subsection{Initial Formula}

The starting point is the DQM (\ref{formula:dqm.result}).
The approach transforms the formula in a way that it uses binary variables instead of discrete variables.
Additionally, the QUBO has to ensure that only one of the binary variables corresponding to one power plant $i$ at one time $t$ is $1$.

\subsection{Rewrite Quadratic Biases}

The transformation of the quadratic biases has two parts.
The first part is the transformation of the startup and shutdown costs.
\begin{align}
  \gamma_s \sum_i \sum_{t > 0} S_i \left( p_{i, t-1} \otimes p_{i, t} \right)
  = \gamma_s \sum_i \sum_{t, k > 0} \left(
    A_i^D \cdot p_{i, t-1, k} \cdot p_{i, t, 0}
    + A_i^U \cdot p_{i, t-1, 0} \cdot p_{i, t, k}
  \right)
\end{align}

Penalties $A_i^U$ and $A_i^D$ apply if the power level of the plant $i$ is $0$ at time $t-1$ and non-zero at time $t$ respectively non-zero at time $t-1$ and $0$ at time $t$.

The second part is the transformation of the quadratic biases connected to the demand.
\begin{align}
  \gamma_d \sum_t \sum_{i < j} \left( P_i \otimes P_j \right) \left( p_{i, t} \otimes p_{j, t} \right)
  = \gamma_d \sum_{i, k, l} \sum_{i < j} \left( P_{i,k} \cdot P_{j,l} \cdot p_{i, t, k} \cdot p_{j, t, l} \right)
\end{align}

It is more straightforward and shows the meaning of the tensor products and the Frobenius inner product used in the DQM.

\subsection{Rewrite Linear Biases}

The transformation of the linear biases has two parts.
The first part is the transformation of the objective and demand related biases.
\begin{align}
  \sum_{i, t} \left(
    \gamma_c \cdot F_i + \gamma_d \left( P_i^{\odot 2} - l_t \cdot P_i \right)
  \right) p_{i, t}
  =
  \sum_{i, t, k} \left(
    \gamma_c \cdot F_{i, k} + \gamma_d \left( P_{i, k}^2 - l_t \cdot P_{i, t} \right)
  \right)
\end{align}

Where $F_{i, k}$ is defined as follows:
\begin{align}
  F_{i, k} = \begin{cases}
    0 & , k = 0 \\
    A_i + B_i \cdot P_{i, k} + C_i \cdot P_{i, k}^2 & , else
  \end{cases}
\end{align}

The second part of the transformation is the startup and shutdown costs of the first time instance.
\begin{align}
  \sum_{i, k} S_{i, k}^{(0)} \cdot p_{i, 0, k}
  & & \text{where }
  S_{i, k}^{(0)} = \begin{cases}
    A_i^U & , u_{i, -1} = 0 \land k > 0 \\
    A_i^D & , u_{i, -1} = 1 \land k = 0 \\
    0 & , else
  \end{cases}
\end{align}

\subsection{Discretize $p_{i, t, k}$}

Since the variables in the QUBO are binary, each represents a single possible power level $k$ of power plant $i$ at time $t$.
Each power plant $i$ may only have one output level at each time instance $t$.
So the QUBO should avoid that multiple binary variables for different power levels $k$ and $l$ are $1$ for the same power plant $i$ at the same time $t$.
Penalizing multiple possible power output values for each plant at every time avoids this.
\begin{subequations}
\begin{align}
  & \gamma_p \sum_{i, t} \left( \left( \sum_k p_{i, t, k} \right) - 1 \right)^2
  \\ = \quad &
  \gamma_p \sum_{i, t} \left(
    1
    + \sum_k \left( p_{i, t, k} \right)^2
    - \sum_k \left( p_{i, t, k} \right)
    + \sum_{k < l} \left( p_{i, t, k} \cdot p_{i, t, l} \right)
  \right)
  \\ = \quad &
  \gamma_p \sum_{i, t} \left(
    1
    + \sum_{k < l} \left( p_{i, t, k} \cdot p_{i, t, l} \right)
  \right)
\end{align}
\end{subequations}

\subsection{Final Formula}

After adding all parts together again, we obtain the following QUBO.
\begin{subequations}
\begin{align}
  \begin{split}
  E(p) = \quad &
  \gamma_s \sum_i \sum_{t, k > 0} \left(
      A_i^D \cdot p_{i, t-1, k} \cdot p_{i, t, 0}
      + A_i^U \cdot p_{i, t-1, 0} \cdot p_{i, t, k}
    \right)
    \\ + \quad & \gamma_d \sum_{i, k, l} \sum_{i < j} \left(
      P_{i,k} \cdot P_{j,l} \cdot p_{i, t, k} \cdot p_{j, t, l}
    \right)
  + \gamma_p \sum_{i, t} \sum_{k < l} \left( p_{i, t, k} \cdot p_{i, t, l} \right)
  \end{split}
  & \text{(quadratic)} \\
  + \quad &
  \sum_{i, t, k} \left(
    \gamma_c \cdot F_{i, k}
    + \gamma_d \left( P_{i, k}^2 - l_t \cdot P_{i, k} \right)
  \right) p_{i, t, k}
  + \sum_{i, k} \left( S_{i, k}^{(0)} \cdot p_{i, 0, k} \right)
  & \text{(linear)}
  \label{formula:qubo.result.linear} \\
  + \quad &
  1 + \sum_t l_t^2
  & \text{(constant)}
  \label{formula:qubo.result.constant}
\end{align}
\label{formula:qubo.result}
\end{subequations}

\subsection{Model Size}
\label{approach:qubo.size}

The size of QUBOs consists of the same $3$ parts as DQMs (section \ref{approach:dqm.size}):
\begin{enumerate*}[label=(\roman*)]
  \item Number of variables,
  \item Number of linear biases, and
  \item Number of quadratic biases.
\end{enumerate*}
The number of variables $v_{\text{QUBO}}$ is identical to the number of linear biases.
Formula (\ref{formula:qubo.num.variables}) gives the number of variables.
Formula (\ref{formula:qubo.num.quadratic.biases}) gives the number of quadratic biases.
With this model, the linear and quadratic biases are both plain numbers.
\begin{subequations}
\begin{align}
  \label{formula:qubo.num.variables}
  v_{\text{QUBO}} = & \qquad
  \aT \cdot \sum_{i \in \aI} 2^{n_i}
  \\
  \label{formula:qubo.num.quadratic.biases}
  q_{\text{QUBO}} = & \qquad
  \left( \aT - 1 \right) \cdot 2 \sum_{i \in \aI} 2^{n_i}
  + \aT \cdot \left(
    \sum_{i, j \in \I, i \neq j} 2^{n_i} \cdot 2^{n_j}
    + \sum_{i \in \I} \frac{2^{n_i} \cdot \left( 2^{n_i} - 1 \right)}{2}
  \right)
\end{align}
\end{subequations}
